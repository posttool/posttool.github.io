<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title></title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="apple-touch-icon" href="apple-touch-icon.png">
        <!-- 
        <link rel="stylesheet" href="css/normalize.css">
        <link rel="stylesheet" href="css/main.css">
        <script src="js/vendor/modernizr-2.8.3.min.js"></script>Place favicon.ico in the root directory -->
        <script src="js/menu.js"></script>
        <script src="js/vendor/three/RequestAnimationFrame.js"></script>
        <script src="js/vendor/three/ThreeCanvas.js"></script>
        <script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
        <script type="text/javascript" src="http://cdn.tonejs.org/latest/Tone.min.js"></script>
        <style>
* { margin:0; padding:0; } 
html, body { width:100%; height:100%; } 
canvas { display:block; } 
        </style>
    </head>
    <body>
        <!--[if lt IE 8]>
            <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->
        <canvas id="menu_canvas" ></canvas>

        <script>
        $(document).on('ready', function(){
            var canvas = document.getElementById('menu_canvas');
            var context = canvas.getContext('2d');

            var x = xmenu(context);
            x.animate();
            //setInterval(function(){ x.move(); x.animate(); }, 1100);

            //create one of Tone's built-in synthesizers
            var synth = new Tone.PolySynth(12, Tone.FMSynth);
            synth.set({
                envelope : {
                    attack : 0.3, sustain: .1
                }
            });
            synth.toMaster();

            var s2 = new Tone.PolySynth(8, Tone.FMSynth);
            s2.toMaster();

            var la = 0;

            function drone(time){
                if (Math.random()<.5)
                   s2.triggerAttackRelease("C2", .8, time);
                else
                   s2.triggerAttackRelease("G2", .8, time);
                if (Math.random()<.5)
                   s2.triggerAttackRelease("C2", .8, time);
                else
                   s2.triggerAttackRelease("G3", .8, time); //:-()
                if (Math.random()<.5)
                   s2.triggerAttackRelease("C1", .8, time);
                else
                   s2.triggerAttackRelease("D2", .8, time); //:-)(
            }

            var m = 0;
            Tone.Transport.setInterval(function(time){
                m++;
                // droner
                drone(time);
                drone(time+.4);
                drone(time+.05);

                if (la > 0 && m%4==0) {
                    synth.triggerAttackRelease("C4", .2, time);
                    var d = Math.random()>.5?.4:.8;
                    synth.triggerAttackRelease("G4", .4, time+d);
                }
                if (la > 1 && m%3==0) {
                    synth.triggerAttackRelease("E4", .2, time);
                    var d = Math.random()>.5?.4:.8;
                    synth.triggerAttackRelease("F4", .4, time+d);
                }
                if (la > 2&& m%5==0) {
                    synth.triggerAttackRelease("C4", .1, time+.0);
                    synth.triggerAttackRelease("C4", .1, time+.1);
                    synth.triggerAttackRelease("G5", .1, time+.2);
                    synth.triggerAttackRelease("C4", .1, time+.4);
                    synth.triggerAttackRelease("D5", .1, time+.6);
                    synth.triggerAttackRelease("G5", .1, time+.6);
                }
                if (la > 3&& m%8==0) {
                    synth.triggerAttackRelease("B5", .05, time);
                    synth.triggerAttackRelease("C5", .05, time+.1);
                    synth.triggerAttackRelease("G4", .05, time+.2);
                    synth.triggerAttackRelease("F4", .05, time+.3);
                    synth.triggerAttackRelease("C5", .05, time+.4);
                }
                if (la > 4&&m%11==0) {
                    synth.triggerAttackRelease("B5", .05, time);
                    synth.triggerAttackRelease("D5", .05, time+.1);
                    synth.triggerAttackRelease("E4", .05, time+.2);
                    synth.triggerAttackRelease("F4", .05, time+.3);
                    synth.triggerAttackRelease("C5", .05, time+.4);
                    synth.triggerAttackRelease("B5", .05, time+.5);
                    synth.triggerAttackRelease("D5", .05, time+.6);
                    synth.triggerAttackRelease("E4", .05, time+.7);
                    synth.triggerAttackRelease("F4", .05, time+.8);
                    synth.triggerAttackRelease("C5", .05, time+.9);
                }
                if (la > 4&&m%10==0 ) {
                    synth.triggerAttackRelease("D4", .05, time+.4);
                    synth.triggerAttackRelease("E4", .05, time+.5);
                    synth.triggerAttackRelease("F4", .05, time+.6);
                    synth.triggerAttackRelease("G4", .05, time+.8);
                    synth.triggerAttackRelease("C5", .2, time+.9);
                }
                if (la > 5 ) {
                    synth.triggerAttackRelease("D5", .2, time+.1);
                    synth.triggerAttackRelease("D6", .05, time+.4);
                    synth.triggerAttackRelease("D5", .05, time+.5);
                    synth.triggerAttackRelease("D4", .05, time+.6);
                    synth.triggerAttackRelease("D5", .05, time+.8);
                }

                if (Math.random()>.5)
                    x.move();
                console.log(time)

            }, .8);

            //start the transport
            Tone.Transport.start();

            $(document).on('click', function(){ 
                la ++; 
                if (la>6) la=3;
                m = 0;
                x.camera.position.z+=1000;
                console.log(x.camera.position.z)
            })


            // resize
            window.addEventListener('resize', resizeCanvas, false);

            function resizeCanvas() {
                    canvas.width = window.innerWidth;
                    canvas.height = window.innerHeight;
                    
            }
            resizeCanvas();
        });

        </script>

        <!-- Google Analytics: change UA-XXXXX-X to be your site's ID. -->
        <script>
            (function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
            function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
            e=o.createElement(i);r=o.getElementsByTagName(i)[0];
            e.src='https://www.google-analytics.com/analytics.js';
            r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
            ga('create','UA-840716-22','auto');ga('send','pageview');
        </script>
    </body>
</html>